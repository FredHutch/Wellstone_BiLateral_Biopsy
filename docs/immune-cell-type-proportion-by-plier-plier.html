<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 Immune cell type proportion by PLIER {plier} | Wellstone bilateral tibialis anterior FSHD biopsied muscle study</title>
<meta name="author" content="Chao-Jen Wong">
<meta name="description" content="The PLIER package provides an alternative to examine the immune cell infiltration, without involving in GO or differential analysis as we have investigated in Chapter...">
<meta name="generator" content="bookdown 0.32 with bs4_book()">
<meta property="og:title" content="Chapter 9 Immune cell type proportion by PLIER {plier} | Wellstone bilateral tibialis anterior FSHD biopsied muscle study">
<meta property="og:type" content="book">
<meta property="og:url" content="https://fredHutch.github.io/Wellstone_BiLateral_Biopsy/immune-cell-type-proportion-by-plier-plier.html">
<meta property="og:image" content="https://fredHutch.github.io/Wellstone_BiLateral_Biopsy/images/cover.jpeg">
<meta property="og:description" content="The PLIER package provides an alternative to examine the immune cell infiltration, without involving in GO or differential analysis as we have investigated in Chapter...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 9 Immune cell type proportion by PLIER {plier} | Wellstone bilateral tibialis anterior FSHD biopsied muscle study">
<meta name="twitter:description" content="The PLIER package provides an alternative to examine the immune cell infiltration, without involving in GO or differential analysis as we have investigated in Chapter...">
<meta name="twitter:image" content="https://fredHutch.github.io/Wellstone_BiLateral_Biopsy/images/cover.jpeg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Sen-0.4.5/font.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=DM%20Mono&amp;display=swap" rel="stylesheet">
<link href="libs/Bitter-0.4.5/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Wellstone bilateral tibialis anterior FSHD biopsied muscle study</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled"><li><a class="" href="index.html"><span class="header-section-number">Chapter 9</span> Immune cell type proportion by PLIER {plier}</a></li></ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/FredHutch/Wellstone_BiLateral_Biopsy">View book source <i class="fas fa-air-freshener"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="immune-cell-type-proportion-by-plier-plier" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Immune cell type proportion by PLIER {plier}<a class="anchor" aria-label="anchor" href="#immune-cell-type-proportion-by-plier-plier"><i class="fas fa-link"></i></a>
</h1>
<p>The <em>PLIER</em> package provides an alternative to examine the immune cell infiltration, without involving in GO or differential analysis as we have investigated in Chapter @ref{immune-cell-infiltrates}. PLIER performs eigenvalue-like decomposition to estimate the immune cell contribution to the FSHD transcriptome. The top loading variables of the resulted eigenvalue-like latent variables (LV) are also potential candidates of immune infiltrate signature. We applied the PLIER algorithm to both longitudinal and bilateral samples. The expression levels of the top loading variables are illustrated below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkg_dir</span> <span class="op">&lt;-</span> <span class="st">"/Users/cwon2/CompBio/Wellstone_BiLateral_Biopsy"</span></span>
<span><span class="va">fig_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">pkg_dir</span>, <span class="st">"figures"</span>, <span class="st">"immune-infiltration"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">pkg_dir</span>, <span class="st">"scripts"</span>, <span class="st">"load_variables_and_datasets.R"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># returns bilat_dds and longitudinal_dds</span></span></code></pre></div>
<p>Load datasets from <em>PLIER</em>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">PLIER</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">bloodCellMarkersIRISDMAP</span><span class="op">)</span></span>
<span><span class="va">blood_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">bloodCellMarkersIRISDMAP</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rownames_to_column</span><span class="op">(</span>var<span class="op">=</span><span class="st">"gene_name"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">gene_name</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"IRIS"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">bilat_coldata</span> <span class="op">&lt;-</span> <span class="fu">colData</span><span class="op">(</span><span class="va">bilat_dds</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">longi_coldata</span> <span class="op">&lt;-</span> <span class="fu">colData</span><span class="op">(</span><span class="va">longitudinal_dds</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="longitudinal-samples-1" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> Longitudinal samples<a class="anchor" aria-label="anchor" href="#longitudinal-samples-1"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>run PLIER, the priorMat only includes the IRIS dataset (<code>blood_iris</code>)</li>
<li>Select top LVs with AUC &gt; 0.8 and FDR &lt; 0.05</li>
<li>Verify the top LVs and filter out the false positives</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use RPKM and Moderate+ classes</span></span>
<span><span class="va">sub</span> <span class="op">&lt;-</span> <span class="va">longitudinal_dds</span><span class="op">[</span>, <span class="va">longitudinal_dds</span><span class="op">$</span><span class="va">cluster</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"High"</span>, <span class="st">"IG-High"</span>, <span class="st">"Moderate"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#longitudinal_tpm &lt;- assays(sub)[["TPM"]]</span></span>
<span><span class="va">longitudinal_rpkm</span> <span class="op">&lt;-</span> <span class="fu">assays</span><span class="op">(</span><span class="va">longitudinal_dds</span><span class="op">)</span><span class="op">[[</span><span class="st">"RPKM"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">longitudinal_tpm</span> <span class="op">&lt;-</span> <span class="fu">assays</span><span class="op">(</span><span class="va">longitudinal_dds</span><span class="op">)</span><span class="op">[[</span><span class="st">"TPM"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">longitudinal_rpkm</span><span class="op">)</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">longitudinal_tpm</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">rowData</span><span class="op">(</span><span class="va">longitudinal_dds</span><span class="op">)</span><span class="op">$</span><span class="va">gene_name</span></span>
<span></span>
<span><span class="va">priorMat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">bloodCellMarkersIRISDMAP</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">blood_iris</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># remove col "gene_name" </span></span>
<span><span class="va">plier_longi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PLIER/man/PLIER.html">PLIER</a></span><span class="op">(</span><span class="va">longitudinal_rpkm</span>, <span class="co"># or longitudinal_rpkm</span></span>
<span>                     priorMat<span class="op">=</span><span class="va">priorMat</span>,</span>
<span>                     scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 24.90828</span></span>
<span><span class="co">#&gt; [1] "L2 is set to 24.908276840206"</span></span>
<span><span class="co">#&gt; [1] "L1 is set to 12.454138420103"</span></span>
<span><span class="va">mat_u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PLIER/man/plotU.html">plotU</a></span><span class="op">(</span><span class="va">plier_longi</span>, auc.cutoff <span class="op">=</span> <span class="fl">0.70</span>, fdr.cutoff <span class="op">=</span> <span class="fl">0.05</span>, top <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:longitudinal-prepare-for-plier"></span>
<img src="09-immune-cell-type-proportion_files/figure-html/longitudinal-prepare-for-plier-1.png" alt="Significance LVs with AUC &gt; 0.8 and FDR &lt; 0.05." width="672"><p class="caption">
Figure 9.1: Significance LVs with AUC &gt; 0.8 and FDR &lt; 0.05.
</p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sig_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mat_u</span><span class="op">$</span><span class="va">iirow</span><span class="op">)</span><span class="op">[</span><span class="va">mat_u</span><span class="op">$</span><span class="va">iirow</span><span class="op">]</span></span></code></pre></div>
<p>As we visualized the proportion,</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># proportion boxplots of all the sig LVs and outliers (in terms of proportions)</span></span>
<span><span class="va">sig_proportion_longi</span> <span class="op">&lt;-</span> <span class="va">plier_longi</span><span class="op">$</span><span class="va">B</span><span class="op">[</span><span class="va">mat_u</span><span class="op">$</span><span class="va">iicol</span>, <span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rownames_to_column</span><span class="op">(</span>var<span class="op">=</span><span class="st">"LV_index"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/gather.html">gather</a></span><span class="op">(</span>key<span class="op">=</span><span class="va">sample_id</span>, value<span class="op">=</span><span class="va">proportion</span>, <span class="op">-</span><span class="va">LV_index</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">longi_coldata</span>, <span class="va">sample_id</span>, <span class="va">cluster</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"sample_id"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">outliers</span> <span class="op">&lt;-</span> <span class="va">sig_proportion_longi</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">proportion</span> <span class="op">&gt;</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sig_proportion_longi</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">proportion</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">cluster</span>, y<span class="op">=</span><span class="va">proportion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.3</span>, outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.3</span>, size<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">LV_index</span>, scale<span class="op">=</span><span class="st">"free_y"</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="09-immune-cell-type-proportion_files/figure-html/plier-B-and-Z-1.png" width="768"></div>
<div id="five-best-lvs-showing-immunity-cell-infiltration" class="section level3" number="9.1.1">
<h3>
<span class="header-section-number">9.1.1</span> Five best LVs showing immunity cell infiltration<a class="anchor" aria-label="anchor" href="#five-best-lvs-showing-immunity-cell-infiltration"><i class="fas fa-link"></i></a>
</h3>
<p>Summarising the U, top Z, and B matries, LV30, LV4, LV5, LV12 and LV46 are most trustworthy latent variables showing elevated immunity cell infiltration. Here we make plots of our publication: LV30 (CD4 Tcell-Th1), L4/L12 (Neutrophil resting), and LV40 (IgG and IgA B memory cell), LV5 (dendritic cell).</p>
<div id="lv30iris_cd4tcell-th1-restimulated48hour" class="section level4" number="9.1.1.1">
<h4>
<span class="header-section-number">9.1.1.1</span> LV30,IRIS_CD4Tcell-Th1-restimulated48hour<a class="anchor" aria-label="anchor" href="#lv30iris_cd4tcell-th1-restimulated48hour"><i class="fas fa-link"></i></a>
</h4>
<p><img src="09-immune-cell-type-proportion_files/figure-html/LV30-longitudinal-proportion-1.png" width="672">
#### LV4,IRIS_Neutrophil-Resting
<img src="09-immune-cell-type-proportion_files/figure-html/L4-proportion-IRIS_Neutrophil-Resting-1.png" width="672"></p>
</div>
<div id="lv12iris_neutrophil-resting" class="section level4" number="9.1.1.2">
<h4>
<span class="header-section-number">9.1.1.2</span> LV12,IRIS_Neutrophil-Resting<a class="anchor" aria-label="anchor" href="#lv12iris_neutrophil-resting"><i class="fas fa-link"></i></a>
</h4>
<div class="inline-figure"><img src="09-immune-cell-type-proportion_files/figure-html/L12-proportion-IRIS_Neutrophil-Resting-1.png" width="672"></div>
</div>
<div id="lv5iris_dendriticcell-lpsstimulated" class="section level4" number="9.1.1.3">
<h4>
<span class="header-section-number">9.1.1.3</span> LV5,IRIS_DendriticCell-LPSstimulated<a class="anchor" aria-label="anchor" href="#lv5iris_dendriticcell-lpsstimulated"><i class="fas fa-link"></i></a>
</h4>
<div class="inline-figure"><img src="09-immune-cell-type-proportion_files/figure-html/LV5-proportion-IRIS_DendrticCell-1.png" width="672"></div>
</div>
<div id="lv40iris_bcell-memory_igg_iga" class="section level4" number="9.1.1.4">
<h4>
<span class="header-section-number">9.1.1.4</span> LV40,IRIS_Bcell-Memory_IgG_IgA<a class="anchor" aria-label="anchor" href="#lv40iris_bcell-memory_igg_iga"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sig_proportion_longi</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">LV_index</span><span class="op">==</span><span class="st">"40,IRIS_Bcell-Memory_IgG_IgA"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">cluster</span>, y<span class="op">=</span><span class="va">proportion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span>, outlier.shape<span class="op">=</span><span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">"grey25"</span>,  alpha<span class="op">=</span><span class="fl">0.5</span>, size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>          axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">9</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">10</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">9</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"LV40, B cell memory "</span>, </span>
<span>         subtitle<span class="op">=</span><span class="st">"Longitudinal cohort"</span>,</span>
<span>         y<span class="op">=</span><span class="st">"Relative proportion"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_break</span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">8</span><span class="op">)</span>, ticklabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="09-immune-cell-type-proportion_files/figure-html/LV40-Bcell-Memory_IgG_IgA-1.png" width="672"></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    </span>
<span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">pkg_dir</span>, <span class="st">"figures"</span>, <span class="st">"immune-infiltration"</span>,</span>
<span>                 <span class="st">"longitudinal-Bcell-Memory-IgG-IgA-proportion.pdf"</span><span class="op">)</span>,</span>
<span>       width<span class="op">=</span><span class="fl">2</span>, height<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="top-loading-variables-z-of-selected-lvs" class="section level3" number="9.1.2">
<h3>
<span class="header-section-number">9.1.2</span> Top loading variables Z of selected LVs<a class="anchor" aria-label="anchor" href="#top-loading-variables-z-of-selected-lvs"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LV_index</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">12</span>, <span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">LV_index</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">plier_longi</span><span class="op">$</span><span class="va">B</span><span class="op">[</span><span class="va">LV_index</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">priorMat</span> <span class="op">&lt;-</span> <span class="va">bloodCellMarkersIRISDMAP</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">blood_iris</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">top</span> <span class="op">=</span> <span class="fl">15</span></span>
<span><span class="va">sub_iris</span> <span class="op">&lt;-</span> <span class="va">blood_iris</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">gene_name</span>, <span class="va">`IRIS_CD4Tcell-Th1-restimulated48hour`</span>,</span>
<span>                <span class="va">`IRIS_CD4Tcell-Th2-restimulated48hour`</span>, </span>
<span>                <span class="va">`IRIS_DendriticCell-Control`</span>,</span>
<span>                <span class="va">`IRIS_DendriticCell-LPSstimulated`</span>,</span>
<span>                <span class="va">`IRIS_CD4Tcell-Th2-restimulated12hour`</span>,</span>
<span>                <span class="va">`IRIS_Bcell-Memory_IgG_IgA`</span>,</span>
<span>                <span class="va">`IRIS_Neutrophil-Resting`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">longi_topZ</span> <span class="op">&lt;-</span> <span class="fu">map_dfr</span><span class="op">(</span><span class="va">LV_index</span>, <span class="kw">function</span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plier_longi</span><span class="op">$</span><span class="va">Z</span><span class="op">[</span>, <span class="va">index</span>, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="op">-</span><span class="va">V1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">top_n</span><span class="op">(</span><span class="va">top</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">V1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="co">#dplyr::rename_with(~paste0("LV", as.character(index))) %&gt;%</span></span>
<span>    <span class="fu">rownames_to_column</span><span class="op">(</span>var<span class="op">=</span><span class="st">"gene_name"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">left_join</span><span class="op">(</span><span class="va">sub_iris</span>, by<span class="op">=</span><span class="st">"gene_name"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># turn NA to 0</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>in_markerSet <span class="op">=</span> </span>
<span>                    <span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>                                    <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, .after<span class="op">=</span><span class="va">gene_name</span><span class="op">)</span></span>
<span>    <span class="co"># which pathway?</span></span>
<span><span class="op">}</span>, .id<span class="op">=</span><span class="st">"LV_index"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># append gene_id</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">anno_ens88</span>, by<span class="op">=</span><span class="st">"gene_name"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">anno_gencode35</span>, <span class="va">gencode35_id</span>, <span class="va">gene_name</span><span class="op">)</span>, </span>
<span>            by<span class="op">=</span><span class="st">"gene_name"</span><span class="op">)</span></span>
<span><span class="va">longi_topZ</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">LV_index</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">summarize</span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">in_markerSet</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span><span class="co">#&gt;   LV_index                                    n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 12,IRIS_Neutrophil-Resting                  7</span></span>
<span><span class="co">#&gt; 2 30,IRIS_CD4Tcell-Th1-restimulated48hour     7</span></span>
<span><span class="co">#&gt; 3 4,IRIS_Neutrophil-Resting                  11</span></span>
<span><span class="co">#&gt; 4 40,IRIS_Bcell-Memory_IgG_IgA               13</span></span>
<span><span class="co">#&gt; 5 5,IRIS_DendriticCell-LPSstimulated          4</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">longi_topZ</span> <span class="op">&lt;-</span> <span class="va">longi_topZ</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>cell_type <span class="op">=</span> <span class="fu">str_replace</span><span class="op">(</span><span class="va">LV_index</span>, <span class="st">"[0-9]*,IRIS_"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">longi_markers</span> <span class="op">&lt;-</span> <span class="fu">map_dfr</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">LV_index</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">lv</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">longi_topZ</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">LV_index</span> <span class="op">==</span> <span class="va">lv</span>, <span class="va">in_markerSet</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">LV_index</span>, <span class="va">cell_type</span>, <span class="va">ens_id</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/arrange.html">arrange</a></span><span class="op">(</span><span class="va">cell_type</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">anno_ens88</span>, <span class="va">ens88_id</span>, <span class="va">ens_id</span>, <span class="va">gene_name</span><span class="op">)</span>, </span>
<span>            by<span class="op">=</span><span class="st">"ens_id"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/rename.html">rename</a></span><span class="op">(</span>gene_id <span class="op">=</span> <span class="va">ens88_id</span><span class="op">)</span></span></code></pre></div>
<p><strong>Heatmap</strong></p>
</div>
</div>
<div id="piler-to-the-bilateral-cohort" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> PILER to the Bilateral cohort<a class="anchor" aria-label="anchor" href="#piler-to-the-bilateral-cohort"><i class="fas fa-link"></i></a>
</h2>
<p>CUT off values: AUC = 0.7 and FDR = 0.05</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bilat_rpkm</span> <span class="op">&lt;-</span> <span class="fu">assays</span><span class="op">(</span><span class="va">bilat_dds</span><span class="op">)</span><span class="op">[[</span><span class="st">"RPKM"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">bilat_tpm</span> <span class="op">&lt;-</span> <span class="fu">assays</span><span class="op">(</span><span class="va">bilat_dds</span><span class="op">)</span><span class="op">[[</span><span class="st">"TPM"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">bilat_rpkm</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">bilat_tpm</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">rowData</span><span class="op">(</span><span class="va">bilat_dds</span><span class="op">)</span><span class="op">$</span><span class="va">gene_name</span></span>
<span><span class="va">plier_bilat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PLIER/man/PLIER.html">PLIER</a></span><span class="op">(</span><span class="va">bilat_rpkm</span>, <span class="co"># or longitudinal_rpkm</span></span>
<span>                     priorMat<span class="op">=</span><span class="va">priorMat</span>,</span>
<span>                     scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 29.88863</span></span>
<span><span class="co">#&gt; [1] "L2 is set to 29.8886299733202"</span></span>
<span><span class="co">#&gt; [1] "L1 is set to 14.9443149866601"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">plier_bilat</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">pkg_dir</span>, <span class="st">"data"</span>, <span class="st">"plier_bliat.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mat_u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PLIER/man/plotU.html">plotU</a></span><span class="op">(</span><span class="va">plier_bilat</span>, auc.cutoff <span class="op">=</span> <span class="fl">0.7</span>, fdr.cutoff <span class="op">=</span> <span class="fl">0.05</span>, top <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="09-immune-cell-type-proportion_files/figure-html/plier-bilateral-1.png" width="672"></div>
<div id="select-lvs-with-elevated-proportion-in-more-affected-muscles" class="section level3" number="9.2.1">
<h3>
<span class="header-section-number">9.2.1</span> Select LVs with elevated proportion in more affected muscles<a class="anchor" aria-label="anchor" href="#select-lvs-with-elevated-proportion-in-more-affected-muscles"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bilat_col_data</span> <span class="op">&lt;-</span> <span class="fu">colData</span><span class="op">(</span><span class="va">bilat_dds</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define sig LV_index: </span></span>
<span><span class="va">LV_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">14</span>, <span class="fl">18</span>, <span class="fl">20</span>, <span class="fl">26</span>, <span class="fl">22</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">LV_index</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">plier_bilat</span><span class="op">$</span><span class="va">B</span><span class="op">[</span><span class="va">LV_index</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plier_bilat</span><span class="op">$</span><span class="va">B</span><span class="op">[</span><span class="va">LV_index</span>, <span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rownames_to_column</span><span class="op">(</span>var<span class="op">=</span><span class="st">"LV_index"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/gather.html">gather</a></span><span class="op">(</span>key<span class="op">=</span><span class="va">sample_id</span>, value<span class="op">=</span><span class="va">proportion</span>, <span class="op">-</span><span class="va">LV_index</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">bilat_col_data</span>, <span class="va">sample_id</span>, <span class="va">class</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"sample_id"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">proportion</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption<span class="op">=</span><span class="st">"Samples with extreme proportions. Remov ed from the figure below."</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:plier-bilat-proportion">Table 9.1: </span>Samples with extreme proportions. Remov ed from the figure below.
</caption>
<thead><tr>
<th style="text-align:left;">
LV_index
</th>
<th style="text-align:left;">
sample_id
</th>
<th style="text-align:right;">
proportion
</th>
<th style="text-align:left;">
class
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
2,IRIS_Bcell-Memory_IgG_IgA
</td>
<td style="text-align:left;">
32-0020L
</td>
<td style="text-align:right;">
7.740168
</td>
<td style="text-align:left;">
Moderate+
</td>
</tr>
<tr>
<td style="text-align:left;">
20,IRIS_DendriticCell-LPSstimulated
</td>
<td style="text-align:left;">
32-0020L
</td>
<td style="text-align:right;">
4.306802
</td>
<td style="text-align:left;">
Moderate+
</td>
</tr>
<tr>
<td style="text-align:left;">
20,IRIS_DendriticCell-LPSstimulated
</td>
<td style="text-align:left;">
32-0022L
</td>
<td style="text-align:right;">
5.658910
</td>
<td style="text-align:left;">
Moderate+
</td>
</tr>
<tr>
<td style="text-align:left;">
14,IRIS_Neutrophil-Resting
</td>
<td style="text-align:left;">
32-0028R
</td>
<td style="text-align:right;">
3.871969
</td>
<td style="text-align:left;">
Moderate+
</td>
</tr>
<tr>
<td style="text-align:left;">
22,IRIS_Neutrophil-Resting
</td>
<td style="text-align:left;">
32-0029R
</td>
<td style="text-align:right;">
6.573207
</td>
<td style="text-align:left;">
Moderate+
</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># boxplot for proportion of potential LVs</span></span>
<span><span class="va">plier_bilat</span><span class="op">$</span><span class="va">B</span><span class="op">[</span><span class="va">mat_u</span><span class="op">$</span><span class="va">iicol</span>, <span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rownames_to_column</span><span class="op">(</span>var<span class="op">=</span><span class="st">"LV_index"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/gather.html">gather</a></span><span class="op">(</span>key<span class="op">=</span><span class="va">sample_id</span>, value<span class="op">=</span><span class="va">proportion</span>, <span class="op">-</span><span class="va">LV_index</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">bilat_col_data</span>, <span class="va">sample_id</span>, <span class="va">class</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"sample_id"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">proportion</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">class</span>, y<span class="op">=</span><span class="va">proportion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.3</span>, outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.3</span>, size<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">LV_index</span>, scale<span class="op">=</span><span class="st">"free_y"</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Remove outliers with proportion &gt; 3 "</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>          axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="09-immune-cell-type-proportion_files/figure-html/plier-bilat-proportion-1.png" width="576"></div>
</div>
<div id="top-lvs" class="section level3" number="9.2.2">
<h3>
<span class="header-section-number">9.2.2</span> TOP LVs<a class="anchor" aria-label="anchor" href="#top-lvs"><i class="fas fa-link"></i></a>
</h3>
<p>The significant LVs that show elevated proportion in FSHD are LV2 (Bcell-Memory_IgG_IgA), LV22 (Neutrophil-resting) and LV20 (DendriticCell-LPSstimulated). LV18 and LV26 do have elevated proportion in moderatedly-affected muscles.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bilat_proportion</span> <span class="op">&lt;-</span> <span class="va">plier_bilat</span><span class="op">$</span><span class="va">B</span><span class="op">[</span><span class="va">LV_index</span>, <span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rownames_to_column</span><span class="op">(</span>var<span class="op">=</span><span class="st">"LV_index"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidyr/man/gather.html">gather</a></span><span class="op">(</span>key<span class="op">=</span><span class="va">sample_id</span>, value<span class="op">=</span><span class="va">proportion</span>, <span class="op">-</span><span class="va">LV_index</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">bilat_col_data</span>, <span class="va">sample_id</span>, <span class="va">class</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"sample_id"</span><span class="op">)</span> </span></code></pre></div>
<div id="lv2-iris_bcell-memory_igg_iga" class="section level4" number="9.2.2.1">
<h4>
<span class="header-section-number">9.2.2.1</span> LV2, IRIS_Bcell-Memory_IgG_IgA<a class="anchor" aria-label="anchor" href="#lv2-iris_bcell-memory_igg_iga"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bilat_proportion</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">LV_index</span><span class="op">==</span><span class="st">"2,IRIS_Bcell-Memory_IgG_IgA"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">class</span>, y<span class="op">=</span><span class="va">proportion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span>, outlier.shape<span class="op">=</span><span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">"grey25"</span>,  alpha<span class="op">=</span><span class="fl">0.5</span>, size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>          axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">9</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">10</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">9</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"LV2, B cell memory"</span>, </span>
<span>         subtitle<span class="op">=</span><span class="st">"Bilateral cohort"</span>,</span>
<span>         y<span class="op">=</span><span class="st">"Relatitive proportion"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_break</span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">7.5</span><span class="op">)</span>, ticklabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.5</span>, <span class="fl">7.7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.45</span>, <span class="fl">7.8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="09-immune-cell-type-proportion_files/figure-html/LV2-Bcll-memory-1.png" width="672"></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">pkg_dir</span>, <span class="st">"figures"</span>, <span class="st">"immune-infiltration"</span>,</span>
<span>                      <span class="st">"bilateral-LV2-Bcell-memory.pdf"</span><span class="op">)</span>,</span>
<span>       width<span class="op">=</span><span class="fl">1.6</span>, height<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="lv22iris_neutrophil-resting" class="section level4" number="9.2.2.2">
<h4>
<span class="header-section-number">9.2.2.2</span> LV22,IRIS_Neutrophil-Resting<a class="anchor" aria-label="anchor" href="#lv22iris_neutrophil-resting"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bilat_proportion</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">LV_index</span><span class="op">==</span><span class="st">"22,IRIS_Neutrophil-Resting"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">class</span>, y<span class="op">=</span><span class="va">proportion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span>, outlier.shape<span class="op">=</span><span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">"grey25"</span>,  alpha<span class="op">=</span><span class="fl">0.5</span>, size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>          axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">9</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">10</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">9</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"LV22, Neutrophil-Resting"</span>, </span>
<span>         subtitle<span class="op">=</span><span class="st">"Bilateral cohort"</span>,</span>
<span>         y<span class="op">=</span><span class="st">"Relatitive proportion"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_break</span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.2</span>, <span class="fl">6.2</span><span class="op">)</span>, ticklabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6.2</span>, <span class="fl">6.6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.45</span>, <span class="fl">6.7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="09-immune-cell-type-proportion_files/figure-html/bilat-LV22-neutrophil-resting-1.png" width="672"></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">pkg_dir</span>, <span class="st">"figures"</span>, <span class="st">"immune-infiltration"</span>,</span>
<span>                      <span class="st">"bilateral-LV22-Neutrophil-Resting.pdf"</span><span class="op">)</span>,</span>
<span>       width<span class="op">=</span><span class="fl">1.6</span>, height<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="lv20iris_dendriticcell-lpsstimulated" class="section level4" number="9.2.2.3">
<h4>
<span class="header-section-number">9.2.2.3</span> LV20,IRIS_DendriticCell-LPSstimulated<a class="anchor" aria-label="anchor" href="#lv20iris_dendriticcell-lpsstimulated"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bilat_proportion</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">LV_index</span><span class="op">==</span><span class="st">"20,IRIS_DendriticCell-LPSstimulated"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">class</span>, y<span class="op">=</span><span class="va">proportion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span>, outlier.shape<span class="op">=</span><span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">"grey25"</span>,  alpha<span class="op">=</span><span class="fl">0.5</span>, size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>          axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">9</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">10</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">9</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"LV20, Dendritic cell"</span>, </span>
<span>         subtitle<span class="op">=</span><span class="st">"Bilateral cohort"</span>,</span>
<span>         y<span class="op">=</span><span class="st">"Relatitive proportion"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_break</span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, ticklabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="09-immune-cell-type-proportion_files/figure-html/LV20-dendritic-1.png" width="672"></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">pkg_dir</span>, <span class="st">"figures"</span>, <span class="st">"immune-infiltration"</span>,</span>
<span>                      <span class="st">"bilateral-LV20-dendritic-cell.pdf"</span><span class="op">)</span>,</span>
<span>       width<span class="op">=</span><span class="fl">1.6</span>, height<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="top-loading-variables-z-of-selected-lvs-1" class="section level4" number="9.2.2.4">
<h4>
<span class="header-section-number">9.2.2.4</span> Top loading variables (Z) of selected LVs<a class="anchor" aria-label="anchor" href="#top-loading-variables-z-of-selected-lvs-1"><i class="fas fa-link"></i></a>
</h4>
<p>View their expression levels (TPM) using heatmap.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LV_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span>, <span class="fl">22</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">LV_index</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">plier_bilat</span><span class="op">$</span><span class="va">B</span><span class="op">[</span><span class="va">LV_index</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">priorMat</span> <span class="op">&lt;-</span> <span class="va">bloodCellMarkersIRISDMAP</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">blood_iris</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">top</span> <span class="op">=</span> <span class="fl">15</span></span>
<span><span class="va">sub_iris</span> <span class="op">&lt;-</span> <span class="va">blood_iris</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">gene_name</span>, <span class="va">`IRIS_CD4Tcell-Th1-restimulated48hour`</span>,</span>
<span>                <span class="va">`IRIS_CD4Tcell-Th2-restimulated48hour`</span>, </span>
<span>                <span class="va">`IRIS_Bcell-Memory_IgG_IgA`</span>, <span class="va">`IRIS_Bcell-naive`</span>,</span>
<span>                <span class="va">`IRIS_Bcell-naive`</span>, <span class="va">`IRIS_Bcell-Memory_IgM`</span>,</span>
<span>                <span class="va">`IRIS_Neutrophil-Resting`</span>,</span>
<span>                <span class="va">`IRIS_DendriticCell-Control`</span>,</span>
<span>                <span class="va">`IRIS_DendriticCell-LPSstimulated`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bilat_topZ</span> <span class="op">&lt;-</span> <span class="fu">map_dfr</span><span class="op">(</span><span class="va">LV_index</span>, <span class="kw">function</span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plier_bilat</span><span class="op">$</span><span class="va">Z</span><span class="op">[</span>, <span class="va">index</span>, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="op">-</span><span class="va">V1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">top_n</span><span class="op">(</span><span class="va">top</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">V1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="co">#dplyr::rename_with(~paste0("LV", as.character(index))) %&gt;%</span></span>
<span>    <span class="fu">rownames_to_column</span><span class="op">(</span>var<span class="op">=</span><span class="st">"gene_name"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">left_join</span><span class="op">(</span><span class="va">sub_iris</span>, by<span class="op">=</span><span class="st">"gene_name"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># turn NA to 0</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>in_markerSet <span class="op">=</span> </span>
<span>                    <span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>                                    <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, .after<span class="op">=</span><span class="va">gene_name</span><span class="op">)</span></span>
<span><span class="op">}</span>, .id<span class="op">=</span><span class="st">"LV_index"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># append gene_id</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">anno_ens88</span>, by<span class="op">=</span><span class="st">"gene_name"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">anno_gencode35</span>, <span class="va">gencode35_id</span>, <span class="va">gene_name</span><span class="op">)</span>, </span>
<span>            by<span class="op">=</span><span class="st">"gene_name"</span><span class="op">)</span></span>
<span><span class="co">#top_z &lt;- bilat_topZ</span></span>
<span><span class="va">bilat_topZ</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">LV_index</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">summarize</span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">in_markerSet</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span><span class="co">#&gt;   LV_index                                n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                               &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 2,IRIS_Bcell-Memory_IgG_IgA            11</span></span>
<span><span class="co">#&gt; 2 20,IRIS_DendriticCell-LPSstimulated     5</span></span>
<span><span class="co">#&gt; 3 22,IRIS_Neutrophil-Resting              7</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bilat_LV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span>, <span class="fl">22</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bilat_LV</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">plier_bilat</span><span class="op">$</span><span class="va">B</span><span class="op">[</span><span class="va">bilat_LV</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">bilat_topZ</span> <span class="op">&lt;-</span> <span class="va">bilat_topZ</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span><span class="op">(</span>cell_type <span class="op">=</span> <span class="fu">str_replace</span><span class="op">(</span><span class="va">LV_index</span>, <span class="st">"[0-9]*,IRIS_"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bilat_markers</span> <span class="op">&lt;-</span>  <span class="fu">map_dfr</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bilat_LV</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">lv</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">bilat_topZ</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span><span class="op">(</span><span class="va">LV_index</span> <span class="op">==</span> <span class="va">lv</span>, <span class="va">in_markerSet</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">LV_index</span>, <span class="va">cell_type</span>, <span class="va">ens_id</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/arrange.html">arrange</a></span><span class="op">(</span><span class="va">cell_type</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">left_join</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span><span class="op">(</span><span class="va">anno_gencode35</span>, <span class="va">gencode35_id</span>, <span class="va">ens_id</span>, <span class="va">gene_name</span><span class="op">)</span>, </span>
<span>            by<span class="op">=</span><span class="st">"ens_id"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/rename.html">rename</a></span><span class="op">(</span>gene_id <span class="op">=</span> <span class="va">gencode35_id</span><span class="op">)</span></span></code></pre></div>
<p><strong>Heatmap</strong></p>

</div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="empty"></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Wellstone bilateral tibialis anterior FSHD biopsied muscle study</strong>" was written by Chao-Jen Wong. It was last built on 2023-04-10.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
